---
# tasks file for mediawiki
#
- name: "Creating yum repo"
  yum_repository:
    baseurl: "http://mirror.centos.org/centos/7/os/x86_64/"
    description: "Centos_yum"
    enabled: yes
    file: "mediawiki"
    name: "new_centos_yum"
    state: present
    gpgcheck: no
- name: "Installing softwares"
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - httpd 
    - php 
    - php-mysql  
    - php-gd  
    - mariadb-server 
    - php-xml 
    - php-intl  
    - mysql
- name: "Starting the services"
  service:
    name: "{{ item }}"
    state: restarted
    enabled: true
  with_items:
    - httpd
    - mariadb
- name: "Installing mysql-python module"
  pip:
        name: "MySQL-python"
        state: present
- name: "Create database mediawiki_db"
  mysql_db:
         login_user: root
         login_password: redhat
         name: "{{ db_name }}"
         state: present
- name: "Create database user with name 'wiki_user' and password 'mediawiki' with all database privileges"
  mysql_user:
          name: "{{ user_name  }}"
          login_user: root
          login_password: redhat
          password: "{{ user_pass }}"
          priv: '{{ db_name }}.*:ALL,GRANT'
          state: present



